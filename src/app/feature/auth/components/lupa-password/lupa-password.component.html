<div class="container mt-5" id="lupa-password-page">
    <div class="row">
        <div class="col-12 col-sm-8 col-md-6 offset-sm-2  offset-md-3 col-lg-6 offset-lg-3">
            <div class="logo text-center mb-4">
                <img src="assets/images/bri-peduli-logo.webp" alt="logo" width="100">
            </div>

            <!-- Step 1: Input Email -->
            <div class="card" *ngIf="currentStep === 1">
                <!-- <div class="card-header">
                     <h1 class="welcome-title">Selamat Datang di Dashboard BRI Peduli</h1>
                </div> -->
                <div class="card-body">
                    <!-- <p class="text-muted mb-3">
                        Masukkan email Anda dan kami akan mengirim kode OTP untuk mereset password.
                    </p> -->
                    <p class="welcome-subtitle">
                        Masukkan email Anda dan kami akan mengirim kode OTP untuk mereset password.
                    </p>
                    <form>
                        <div class="mt-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control form-control-custom" id="email" name="email"
                                [(ngModel)]="email" (change)="clearValidationError('email')"
                                placeholder="contoh@email.com">
                            <span class="text-error-validation" id="email_error"></span>
                        </div>
                        <!-- <div class="form-group">
                            <label>Email</label>
                            <input type="email" [(ngModel)]="email" name="email" id="email"
                                (change)="clearValidationError('email')" class="form-control"
                                placeholder="contoh@email.com">
                            <span class="text-danger" id="email_error"></span>
                        </div> -->

                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <a [routerLink]="['/auth/login']" class="text-primary">
                                <i class="fa fa-arrow-left"></i> Kembali ke Login
                            </a>
                            <button type="button" class="v-btn v-btn--primary " style="width: 110px;"
                                (click)="sendOTP()" [disabled]="isLoading">
                                Kirim OTP
                            </button>
                        </div>

                        <!-- <div class="d-flex justify-content-between align-items-center mt-4">
                            <a [routerLink]="['/auth/login']" class="text-primary">
                                <i class="fa fa-arrow-left"></i> Kembali ke Login
                            </a>
                            <button type="button" (click)="sendOTP()" class="btn btn-primary" [disabled]="isLoading">
                                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                                Kirim OTP
                            </button>
                        </div> -->
                    </form>
                </div>
            </div>

            <!-- Step 2: Verifikasi OTP -->
            <div class="card" *ngIf="currentStep === 2">
                <div class="card-header">
                    <h5>Verifikasi Kode OTP</h5>
                </div>
                <div class="card-body">
                    <p class="welcome-subtitle">
                        Masukkan kode OTP 6 digit yang telah dikirim ke email <strong>{{ maskedEmail }}</strong>
                    </p>

                    <div class="alert alert-danger" *ngIf="otpError">
                        {{ otpError }}
                    </div>

                    <form>
                        <!-- <div class="form-group">
                            <label>Kode OTP</label>
                            <input type="text" [(ngModel)]="otp" name="otp" id="otp" (input)="onOTPInput($event)"
                                (change)="clearValidationError('otp')" class="form-control text-center"
                                placeholder="000000" maxlength="6">
                            <span class="text-danger" id="otp_error"></span>
                        </div> -->

                        <div class="form-group">
                            <label>Kode OTP</label>

                            <div class="otp-container">
                                <input *ngFor="let item of otpInputs; let i = index" class="otp-input" type="text"
                                    maxlength="1" inputmode="numeric" autocomplete="one-time-code" [id]="'otp-' + i"
                                    (input)="onOtpInput($event, i)" (keydown)="onOtpKeyDown($event, i)"
                                    (paste)="onOtpPaste($event)" />
                            </div>

                            <span class="text-danger" id="otp_error"></span>
                        </div>


                        <!-- Countdown Timer -->
                        <div class="text-center mb-3">
                            <div *ngIf="canResendOTP; else countdownBlock">
                                <button type="button" class="btn btn-link p-0" (click)="resendOTP()"
                                    [disabled]="isLoading">
                                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                                    Kirim ulang OTP
                                </button>
                            </div>

                            <ng-template #countdownBlock>
                                <small class="text-muted">
                                    Kirim ulang OTP dalam <strong>{{ formatCountdown() }}</strong>
                                </small>
                            </ng-template>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <!-- <button type="button" class="btn btn-outline-secondary" (click)="backToEmail()">
                                <i class="fa fa-arrow-left"></i> Kembali
                            </button> -->
                            <!-- <button type="button" (click)="verifyOTP()" class="btn btn-primary" [disabled]="isLoading">
                                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                                Verifikasi
                            </button> -->

                            <button type="button" class="v-btn v-btn--primary v-btn--outline" style="width: 110px;"
                                (click)="backToEmail()">
                                Kembali
                            </button>
                            <button type=" button" class="v-btn v-btn--primary " style="width: 110px;"
                                (click)="verifyOTP()" [disabled]="isLoading">
                                Verifikasi
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Step 3: Reset Password -->
            <div class="card" *ngIf="currentStep === 3">
                <div class="card-header">
                    <h5>Buat Password Baru</h5>
                </div>
                <div class="card-body">
                    <p class="welcome-subtitle">
                        Masukkan password baru Anda. Pastikan password memenuhi syarat keamanan.
                    </p>

                    <form class="mt-3">
                        <!-- New Password -->
                        <div class="form-group">
                            <label class="form-label">Password Baru</label>
                            <div class="input-group">
                                <input [type]="showNewPassword ? 'text' : 'password'" [(ngModel)]="newPassword"
                                    name="newPassword" id="newPassword" (input)="onPasswordChange()"
                                    (change)="clearValidationError('newPassword')"
                                    class="form-control form-control-custom" placeholder="Masukkan password baru">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button"
                                        (click)="toggleNewPassword()">
                                        <i class="fa" [class.fa-eye]="!showNewPassword"
                                            [class.fa-eye-slash]="showNewPassword"></i>
                                    </button>
                                </div>
                            </div>
                            <span class="text-danger" id="newPassword_error"></span>

                            <!-- Password Requirements -->
                            <div class="password-requirements mt-2" *ngIf="newPassword">
                                <small [class.text-success]="passwordValidation.minLength"
                                    [class.text-danger]="!passwordValidation.minLength">
                                    <i class="fa" [class.fa-check]="passwordValidation.minLength"
                                        [class.fa-times]="!passwordValidation.minLength"></i>
                                    Minimal 8 karakter
                                </small><br>
                                <small [class.text-success]="passwordValidation.hasUpperLower"
                                    [class.text-danger]="!passwordValidation.hasUpperLower">
                                    <i class="fa" [class.fa-check]="passwordValidation.hasUpperLower"
                                        [class.fa-times]="!passwordValidation.hasUpperLower"></i>
                                    Huruf besar dan kecil
                                </small><br>
                                <small [class.text-success]="passwordValidation.hasNumber"
                                    [class.text-danger]="!passwordValidation.hasNumber">
                                    <i class="fa" [class.fa-check]="passwordValidation.hasNumber"
                                        [class.fa-times]="!passwordValidation.hasNumber"></i>
                                    Mengandung angka
                                </small><br>
                                <small [class.text-success]="passwordValidation.hasSpecial"
                                    [class.text-danger]="!passwordValidation.hasSpecial">
                                    <i class="fa" [class.fa-check]="passwordValidation.hasSpecial"
                                        [class.fa-times]="!passwordValidation.hasSpecial"></i>
                                    Karakter spesial (!@#$%^&*)
                                </small>
                            </div>
                        </div>

                        <!-- Confirm Password -->
                        <div class="form-group">
                            <label class="form-label">Konfirmasi Password</label>
                            <div class="input-group">
                                <input [type]="showConfirmPassword ? 'text' : 'password'" [(ngModel)]="confirmPassword"
                                    name="confirmPassword" id="confirmPassword"
                                    (change)="clearValidationError('confirmPassword')"
                                    class="form-control form-control-custom" placeholder="Ulangi password baru">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button"
                                        (click)="toggleConfirmPassword()">
                                        <i class="fa" [class.fa-eye]="!showConfirmPassword"
                                            [class.fa-eye-slash]="showConfirmPassword"></i>
                                    </button>
                                </div>
                            </div>
                            <span class="text-danger" id="confirmPassword_error"></span>
                        </div>

                        <div class="d-flex justify-content-end">
                            <button type="button" (click)="resetPassword()" class="v-btn v-btn--primary mt-4"
                                [disabled]="isLoading">
                                Simpan Password Baru
                            </button>
                        </div>

                    </form>
                </div>
            </div>

            <div class="text-center mt-4">
                <small class="text-muted">Copyright Â© SRAPP {{ currentYear }}</small>
            </div>
        </div>
    </div>
</div>